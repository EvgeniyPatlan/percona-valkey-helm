## @section Global parameters
nameOverride: ""
fullnameOverride: ""

## @section Deployment mode
## "standalone" or "cluster"
mode: standalone

## @section Image configuration
image:
  repository: perconalab/valkey
  ## Image variant: "rpm" (UBI9) or "hardened" (DHI)
  variant: rpm
  ## Overrides the image tag (default: appVersion for rpm, appVersion-hardened for hardened)
  tag: ""
  pullPolicy: IfNotPresent
  pullSecrets: []

## @section Authentication
auth:
  enabled: true
  ## Valkey password (auto-generated if empty)
  password: ""
  ## Use existing Secret (key: valkey-password)
  existingSecret: ""
  ## Mount password as file instead of env var (more secure)
  usePasswordFiles: false
  ## Directory where password file is mounted
  passwordFilePath: /opt/valkey/secrets

## @section Valkey configuration
config:
  maxmemory: ""
  maxmemoryPolicy: ""
  bind: "0.0.0.0"
  ## Additional flags passed via VALKEY_EXTRA_FLAGS env var
  extraFlags: ""
  ## Custom valkey.conf content appended to generated config
  customConfig: ""

## @section Cluster mode settings
cluster:
  replicas: 6
  replicasPerPrimary: 1
  nodeTimeout: 15000
  busPort: 16379

## @section Standalone mode settings
standalone:
  replicas: 1

## @section StatefulSet parameters
statefulset:
  updateStrategy:
    type: RollingUpdate
  podManagementPolicy: ""
  annotations: {}
  labels: {}

## @section Pod parameters
podAnnotations: {}
podLabels: {}

## @section Security context
securityContext:
  runAsUser: 999
  runAsGroup: 999
  fsGroup: 999
  runAsNonRoot: true

containerSecurityContext:
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

## @section Service parameters
service:
  type: ClusterIP
  port: 6379
  annotations: {}

## @section Persistence
persistence:
  enabled: true
  storageClass: ""
  accessModes:
    - ReadWriteOnce
  size: 8Gi
  annotations: {}

## @section Health probes
livenessProbe:
  enabled: true
  initialDelaySeconds: 20
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
  successThreshold: 1

readinessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

startupProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30

## @section Resources
resources:
  limits: {}
  requests: {}

## @section ServiceAccount
serviceAccount:
  create: true
  name: ""
  annotations: {}
  automountServiceAccountToken: false

## @section RBAC
rbac:
  create: true

## @section PodDisruptionBudget (cluster mode only)
pdb:
  enabled: true
  minAvailable: ""
  maxUnavailable: 1

## @section Disable dangerous commands
## Commands listed here are renamed to "" (disabled) in valkey.conf
disableCommands:
  - FLUSHDB
  - FLUSHALL
## Per-mode overrides (optional). If set, these replace disableCommands for that mode.
# disableCommandsStandalone: []
# disableCommandsCluster: []

## @section Network Policy
networkPolicy:
  enabled: false
  ## Allow connections from outside the cluster
  allowExternal: true
  ## Additional ingress rules
  extraIngress: []
  ## Additional egress rules
  extraEgress: []

## @section Init containers
## sysctl tuning (requires privileged init container)
sysctlInit:
  enabled: false
  somaxconn: 512
  disableTHP: true
  resources: {}

## Fix volume permissions for PVC (runs as root)
volumePermissions:
  enabled: false
  resources: {}

## @section Metrics (Prometheus exporter)
metrics:
  enabled: false
  image:
    repository: oliver006/redis_exporter
    tag: v1.67.0
    pullPolicy: IfNotPresent
  port: 9121
  resources: {}
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: 30s
    scrapeTimeout: ""
    labels: {}
  podMonitor:
    enabled: false
    namespace: ""
    interval: 30s
    labels: {}
  prometheusRule:
    enabled: false
    namespace: ""
    labels: {}
    ## Example rules:
    # rules:
    #   - alert: ValkeyDown
    #     expr: redis_up == 0
    #     for: 5m
    #     labels:
    #       severity: critical
    #     annotations:
    #       summary: "Valkey instance {{ $labels.instance }} is down"
    rules: []

## @section Lifecycle hooks
lifecycle: {}
  # postStart:
  #   exec:
  #     command: ["/bin/sh", "-c", "echo started"]
  # preStop:
  #   exec:
  #     command: ["/bin/sh", "-c", "valkey-cli shutdown save"]

## @section Diagnostic mode (overrides entrypoint for debugging)
diagnosticMode:
  enabled: false
  command:
    - sleep
  args:
    - infinity

## @section Extra resources
## Additional volumes to mount on the StatefulSet
extraVolumes: []
## Additional volume mounts for the valkey container
extraVolumeMounts: []
## Additional env vars for the valkey container
extraEnvVars: []

## @section Resource presets
## Predefined resource configurations. Overridden by explicit resources.limits/requests.
## Options: none, nano, micro, small, medium, large, xlarge
resourcePreset: none

## @section Image verification
imageVerification:
  ## Fail if image does not match expected repository prefix
  enabled: false
  allowedRepositories:
    - perconalab/valkey
    - percona/valkey

## @section Persistence
## PVC retention policy (requires Kubernetes 1.27+)
persistentVolumeClaimRetentionPolicy:
  whenDeleted: Retain
  whenScaled: Retain

## @section Node placement
nodeSelector: {}
tolerations: []
affinity: {}
